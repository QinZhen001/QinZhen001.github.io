---
layout:     post
title:      "ç§»åŠ¨ç«¯ç›¸å…³"
date:       2018-03-06 12:54:00
author:     "Qz"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - Other
---

> â€œYeah It's on. â€

# æ­£æ–‡



## ç§»åŠ¨ç«¯é€‚é…

### **flexible å®ç°**

[https://www.toyou.xyz/posts/flexible.js.html](https://www.toyou.xyz/posts/flexible.js.html)

è®©ç½‘é¡µåœ¨å„ç»ˆç«¯ä¸Šçš„å±•ç¤ºæ•ˆæœå°±åƒç¼©æ”¾è®¾è®¡ç¨¿å›¾ç‰‡ä¸€æ ·ï¼Œåœ¨ä¸åŒå±å¹•ä¸Šç­‰æ¯”ç¼©æ”¾ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ä¸æ•´ä½“æ¯”ä¾‹ä¿æŒä¸å˜ï¼ŒçœŸå®è¿˜åŸè®¾è®¡ç¨¿ã€‚



### vw å®ç°


é¦–è¦è§£å†³çš„æ˜¯é€‚é…ç»ˆç«¯ã€‚å›æƒ³ä¸€ä¸‹ï¼Œä»¥å‰çš„Flexibleæ–¹æ¡ˆæ˜¯é€šè¿‡JavaScriptæ¥æ¨¡æ‹Ÿvwçš„ç‰¹æ€§ï¼Œé‚£ä¹ˆåˆ°ä»Šå¤©ä¸ºæ­¢ï¼Œvwå·²ç»å¾—åˆ°äº†ä¼—å¤šæµè§ˆå™¨çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç›´æ¥è€ƒè™‘å°†vwå•ä½è¿ç”¨äºæˆ‘ä»¬çš„é€‚é…å¸ƒå±€ä¸­ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼Œvwæ˜¯åŸºäºViewportè§†çª—çš„é•¿åº¦å•ä½ï¼Œè¿™é‡Œçš„è§†çª—ï¼ˆViewportï¼‰æŒ‡çš„å°±æ˜¯æµè§ˆå™¨å¯è§†åŒ–çš„åŒºåŸŸï¼Œè€Œè¿™ä¸ªå¯è§†åŒºåŸŸæ˜¯window.innerWidth/window.innerHeightçš„å¤§å°ã€‚ç”¨ä¸‹å›¾ç®€å•çš„æ¥ç¤ºæ„ä¸€ä¸‹ï¼š


![enter description here][1]



åœ¨CSS Values and Units Module Level 3ä¸­å’ŒViewportç›¸å…³çš„å•ä½æœ‰å››ä¸ªï¼Œåˆ†åˆ«ä¸ºvwã€vhã€vminå’Œvmaxã€‚


>vminå’Œvmaxæ˜¯æ ¹æ®Viewportä¸­é•¿åº¦åå¤§çš„é‚£ä¸ªç»´åº¦å€¼è®¡ç®—å‡ºæ¥çš„ï¼Œå¦‚æœwindow.innerHeight > window.innerWidthåˆ™vminå–ç™¾åˆ†ä¹‹ä¸€çš„window.innerWidthï¼Œvmaxå–ç™¾åˆ†ä¹‹ä¸€çš„window.innerHeightè®¡ç®—ã€‚

ä½¿ç”¨vwæ¥æ›¿ä»£ä»¥å‰Flexibleä¸­çš„remç¼©æ”¾æ–¹æ¡ˆã€‚

ç›®å‰å‡ºè§†è§‰è®¾è®¡ç¨¿ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨750pxå®½åº¦çš„ï¼Œä»ä¸Šé¢çš„åŸç†æ¥çœ‹ï¼Œé‚£ä¹ˆ100vw = 750pxï¼Œå³1vw = 7.5pxã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¹æ®è®¾è®¡å›¾ä¸Šçš„pxå€¼ç›´æ¥è½¬æ¢æˆå¯¹åº”çš„vwå€¼ã€‚çœ‹åˆ°è¿™é‡Œï¼Œå¾ˆå¤šåŒå­¦å¼€å§‹æ„Ÿåˆ°å´©æºƒï¼Œåˆè¦è®¡ç®—ï¼Œèƒ½ä¸èƒ½ç®€ä¾¿ä¸€ç‚¹ï¼Œèƒ½ä¸èƒ½å†ç®€å•ä¸€ç‚¹ï¼Œå…¶å®æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PostCSSçš„æ’ä»¶postcss-px-to-viewportï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­å†™pxï¼Œæ¯”å¦‚ï¼š

```css
[w-369]{
    width: 369px;
}

[w-369] h2 span {
    background: #FF5000;
    color: #fff;
    display: inline-block;
    border-radius: 4px;
    font-size: 20px;
    text-shadow: 0 2px 2px #FF5000;
    padding: 2px 5px;
    margin-right: 5px;
}
```

PostCSSç¼–è¯‘ä¹‹åå°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å¸¦vwä»£ç ï¼š

```css
[w-369] {
    width: 49.2vw;
}
[w-369] h2 span {
    background: #ff5000;
    color: #fff;
    display: inline-block;
    border-radius: .53333vw;
    text-shadow: 0 0.26667vw 0.26667vw #ff5000;
    padding: .26667vw .66667vw;
}
[w-369] h2 span,
[w-369] i {
    font-size: 2.66667vw;
    margin-right: .66667vw;
}
```

åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥å¯¹è¯¥æ’ä»¶è¿›è¡Œç›¸å…³çš„å‚æ•°é…ç½®ï¼š

```tsx
"postcss-px-to-viewport": {
    viewportWidth: 750,
    viewportHeight: 1334,
    unitPrecision: 5,
    viewportUnit: 'vw',
    selectorBlackList: [],
    minPixelValue: 1,
    mediaQuery: false
}
```

å‡è®¾ä½ çš„è®¾è®¡ç¨¿ä¸æ˜¯750pxè€Œæ˜¯1125pxï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä¿®æ”¹vewportWidthçš„å€¼

**æ€»ç»“**

* ä½¿ç”¨vwæ¥å®ç°é¡µé¢çš„é€‚é…ï¼Œå¹¶ä¸”é€šè¿‡PostCSSçš„æ’ä»¶postcss-px-to-viewportæŠŠpxè½¬æ¢æˆvwã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ’¸ç çš„æ—¶å€™ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•çš„è®¡ç®—ï¼Œä½ åªéœ€è¦æ ¹æ®è®¾è®¡å›¾å†™pxå•ä½
* ä¸ºäº†æ›´å¥½çš„å®ç°é•¿å®½æ¯”ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹äºimgã€vedioå’Œiframeå…ƒç´ ï¼Œé€šè¿‡PostCSSæ’ä»¶postcss-aspect-ratio-miniæ¥å®ç°ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåªéœ€è¦æŠŠå¯¹åº”çš„å®½å’Œé«˜å†™è¿›å»å³å¯
* ä¸ºäº†è§£å†³1pxçš„é—®é¢˜ï¼Œä½¿ç”¨PostCSSæ’ä»¶postcss-write-svg,è‡ªåŠ¨ç”Ÿæˆborder-imageæˆ–è€…background-imageçš„å›¾ç‰‡





## è®¾å¤‡åƒç´ 



### DPR

[ç½‘é¡µé“¾æ¥](http://www.zhangxinxu.com/wordpress/2012/08/window-devicepixelratio/)

æœ¬æ–‡æ‰€è¯´devicePixelRatioå…¶å®æŒ‡çš„æ˜¯window.devicePixelRatio, è¢«æ‰€æœ‰WebKitæµè§ˆå™¨ä»¥åŠOperaæ‰€æ”¯æŒï¼Œéšç€æ˜¾ç¤ºå™¨çš„å‘å±•ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿæ…¢æ…¢ç™»ä¸Šäº†å‰ç«¯æŠ€æœ¯çš„èˆå°ã€‚

ç‰©ç†åˆ†è¾¨ç‡ï¼šç¡¬ä»¶æ‰€æ”¯æŒçš„
é€»è¾‘åˆ†è¾¨ç‡ï¼šè½¯ä»¶å¯ä»¥è¾¾åˆ°çš„    



window.devicePixelRatioæ˜¯è®¾å¤‡ä¸Šç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ (device-independent pixels (dips))çš„æ¯”ä¾‹ã€‚


>å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼šwindow.devicePixelRatio = ç‰©ç†åƒç´  / dips

> CSSåƒç´ ä¹Ÿå°±æ˜¯é€»è¾‘åƒç´ 



è€Œå¯¹äºè§†ç½‘è†œå±å¹•çš„iphoneï¼Œå¦‚iphone4s, çºµå‘æ˜¾ç¤ºçš„æ—¶å€™ï¼Œå±å¹•ç‰©ç†åƒç´ 640åƒç´ ã€‚åŒæ ·ï¼Œå½“ç”¨æˆ·è®¾ç½®`<meta name="viewport" content="width=device-width">`çš„æ—¶å€™ï¼Œå…¶è§†åŒºå®½åº¦å¹¶ä¸æ˜¯640åƒç´ ï¼Œè€Œæ˜¯320åƒç´ ï¼Œè¿™æ˜¯ä¸ºäº†æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒ â€“ æ›´åˆé€‚çš„æ–‡å­—å¤§å°ã€‚

è¿™æ ·ï¼Œåœ¨è§†ç½‘è†œå±å¹•çš„iphoneä¸Šï¼Œå±å¹•ç‰©ç†åƒç´ 640åƒç´ ï¼Œç‹¬ç«‹åƒç´ è¿˜æ˜¯320åƒç´ ï¼Œå› æ­¤ï¼Œwindow.devicePixelRatioç­‰äº2.



### PPI

PPI æ˜¯è‹±æ–‡ Pixels Per Inch çš„ç¼©å†™ï¼Œ**æ„å‘³æ¯å¯¸èƒ½å®¹çº³å¤šå°‘é¢—åƒç´ ï¼Œç”¨äºæè¿°å±å¹•çš„åƒç´ å¯†åº¦**ã€‚æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å°åˆ·ç‰©ä»¥æ— æ•°å¤šçš„å¢¨ç‚¹æ¥æ„æˆå›¾åƒï¼Œè€Œå±å¹•åŒæ ·ä¹Ÿæ˜¯ä»¥ä¸€å®šæ•°é‡çš„å‘å…‰ç‚¹æ¥æ„æˆå›¾åƒã€‚è§è¿‡è¡—ä¸Šé‚£äº›èµ°çº¢å­—çš„ LED æ˜¾ç¤ºå±ä¹ˆï¼Ÿä¸Šé¢çš„é‚£ä¸€é¢—é¢—çš„ LED ç¯å°±æ˜¯è¿™å—å±å¹•çš„å‘å…‰ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ MacBook çš„ Retina æ˜¾ç¤ºå±çš„åŸç†ä¹Ÿè·Ÿè¿™äº›çœ‹èµ·æ¥ååˆ†ç²—ç³™çš„èµ°çº¢å­—æ˜¾ç¤ºå±æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ Retina æ˜¾ç¤ºå±çš„å‘å…‰ç‚¹å¯†åº¦éå¸¸é«˜ï¼Œäººçœ¼å·²ç»çœ‹ä¸å‡ºæ¥é¢—ç²’æ„Ÿè€Œå·²ã€‚å¯¹äºå±å¹•æ¥è¯´ PPI æ˜¯ç”¨äºæè¿°æ¯è‹±å¯¸å‘å…‰ç‚¹æ•°é‡çš„ï¼Œå®ƒè¡¨æ˜äº†ä¸€å—å±å¹•å‘å…‰ç‚¹å¯†åº¦çš„é«˜ä½ï¼Œè¿™äº›å‘å…‰ç‚¹æˆ‘ä»¬æ›´å¸¸ç§°ä¹‹ä¸ºåƒç´ ï¼Œä¸€å—å±å¹•å®½é«˜æœ‰å‡ å¯¸æ˜¯åœ¨ç”Ÿäº§çš„æ—¶å€™å°±è¢«å®šå¥½çš„ï¼Œè€Œå®½é«˜å„èƒ½å®¹çº³ä¸‹å¤šå°‘é¢—åƒç´ ï¼Œä¹Ÿæ˜¯åœ¨ç”Ÿäº§çš„æ—¶å€™å°±è¢«å®šå¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€è¯´çš„ PPI å¯ä»¥è¯´æ˜¯ä¸€ä¸ªç‰©ç†å•ä½ã€‚





## è¯†åˆ«æ¨ªå±

jsè¯†åˆ«

```js
window.addEventListener("resize", ()=>{
    if (window.orientation === 180 || window.orientation === 0) { 
      // æ­£å¸¸æ–¹å‘æˆ–å±å¹•æ—‹è½¬180åº¦
        console.log('ç«–å±');
    };
    if (window.orientation === 90 || window.orientation === -90 ){ 
       // å±å¹•é¡ºæ—¶é’Ÿæ—‹è½¬90åº¦æˆ–å±å¹•é€†æ—¶é’ˆæ—‹è½¬90åº¦
        console.log('æ¨ªå±');
    }  
});

```

cssè¯†åˆ«

```css
@media screen and (orientation: portrait) {
  /*ç«–å±...*/
} 
@media screen and (orientation: landscape) {
  /*æ¨ªå±...*/
}
```





## é’ˆå¯¹ä¸åŒdprå±å¹•é‡‡ç”¨ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡

å¦‚ï¼šåœ¨`dpr=2`çš„å±å¹•ä¸Šå±•ç¤ºä¸¤å€å›¾`(@2x)`ï¼Œåœ¨`dpr=3`çš„å±å¹•ä¸Šå±•ç¤ºä¸‰å€å›¾`(@3x)`ã€‚

ä½¿ç”¨`media`æŸ¥è¯¢åˆ¤æ–­ä¸åŒçš„è®¾å¤‡åƒç´ æ¯”æ¥æ˜¾ç¤ºä¸åŒç²¾åº¦çš„å›¾ç‰‡ï¼š

```scss
.avatar{
            background-image: url(conardLi_1x.png);
        }
        @media only screen and (-webkit-min-device-pixel-ratio:2){
            .avatar{
                background-image: url(conardLi_2x.png);
            }
        }
        @media only screen and (-webkit-min-device-pixel-ratio:3){
            .avatar{
                background-image: url(conardLi_3x.png);
            }
        }
```

> ä¸€èˆ¬ç”¨äºå¤§å›¾å¦‚èƒŒæ™¯å›¾ï¼Œå°å›¾æ ‡æ²¡å¿…è¦ç”¨è¿™ç§æ–¹å¼ï¼Œä¸å€¼å¾—





## ç«¯æ»šåŠ¨å±æ€§

é¡µé¢éœ€è¦è·å–å’Œä¿®æ”¹é¡µé¢çš„æ»šåŠ¨é«˜åº¦ï¼Œè¿›è¡Œçª—å£ç§»åŠ¨çš„å®šä½æ“ä½œã€‚è¿™é‡Œæœ‰ä¸ªå®‰å“æ‰‹æœºå’Œ iOS çš„å…¼å®¹æ€§é—®é¢˜ã€‚

å¯¹äº `document.documentElement.scrollTop` ï¼ŒiOS å¯ä»¥æ­£å¸¸è¯»å–å’Œè®¾ç½®å€¼ï¼Œå®‰å“ä¸å¯ä»¥ï¼ˆè¯»åˆ°çš„å€¼ä¸º 0ï¼Œä¿®æ”¹å€¼ä¸ä¼šçœŸæ­£æ”¹å˜çª—å£æ»šåŠ¨é«˜åº¦ï¼‰ï¼›

å¯¹äº `document.body.scrollTop` ï¼Œå®‰å“å¯ä»¥æ­£å¸¸è¯»å–å’Œè®¾ç½®å€¼ï¼ŒiOS ä¸å¯ä»¥ï¼›

å¯¹äº `window.scrollY` ï¼Œè²Œä¼¼ä¸¤è€…éƒ½å¯ä»¥ã€‚



è·å–çª—å£æ»šåŠ¨é«˜åº¦çš„å…¼å®¹å†™æ³•ï¼š

```js
const scrollTop = Math.max(window.scrollY, document.documentElement.scrollTop, document.body.scrollTop)
```

ä¿®æ”¹çª—å£æ»šåŠ¨é«˜åº¦çš„å…¼å®¹å†™æ³•ï¼š

```js
document.body.scrollTop = 100 // å®‰å“æœ‰æ•ˆ
document.documentElement.scrollTop = 100 // iOSæœ‰æ•ˆ
```







## è§¦æ‘¸äº‹ä»¶



[ç½‘é¡µé“¾æ¥](https://zhuanlan.zhihu.com/p/23509912)

pcä¸Šçš„webé¡µé¢é¼  æ ‡ä¼šäº§ç”Ÿonmousedownã€onmouseupã€onmouseoutã€onmouseoverã€onmousemoveçš„äº‹ä»¶ï¼Œ**ä½†æ˜¯åœ¨ç§»åŠ¨ç»ˆç«¯å¦‚ iphoneã€ipod Touchã€ipadä¸Šçš„webé¡µé¢è§¦å±æ—¶ä¼šäº§ç”Ÿontouchstartã€ontouchmoveã€ontouchendã€ontouchcancel äº‹ä»¶ï¼Œåˆ†åˆ«å¯¹åº”äº†è§¦å±å¼€å§‹ã€æ‹–æ‹½åŠå®Œæˆè§¦å±äº‹ä»¶å’Œå–æ¶ˆã€‚**
* å½“æŒ‰ä¸‹æ‰‹æŒ‡æ—¶ï¼Œè§¦å‘ontouchstartï¼›
* å½“ç§»åŠ¨æ‰‹æŒ‡æ—¶ï¼Œè§¦å‘ontouchmove
* å½“ç§»èµ°æ‰‹æŒ‡æ—¶ï¼Œè§¦å‘ontouchendã€‚
* å½“ä¸€äº›æ›´é«˜çº§åˆ«çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼ˆå¦‚ç”µè¯æ¥å…¥æˆ–è€…å¼¹å‡ºä¿¡æ¯ï¼‰ä¼šå–æ¶ˆå½“å‰çš„touchæ“ä½œï¼Œå³è§¦å‘ontouchcancelã€‚ä¸€èˆ¬ä¼šåœ¨ontouchcancelæ—¶æš‚åœæ¸¸æˆã€å­˜æ¡£ç­‰æ“ä½œã€‚

**ä¸Šé¢çš„è¿™äº›äº‹ä»¶éƒ½ä¼šå†’æ³¡ï¼Œä¹Ÿéƒ½å¯ä»¥å–æ¶ˆ**


>DOM 0çº§äº‹ä»¶ä¸ç”Ÿæ•ˆï¼š
>document.ontouchstart = function(){alert("a")}  //ä¸èµ·ä½œç”¨

è§¦æ‘¸äº‹ä»¶è¿˜åŒ…å«ä¸‹é¢ä¸‰ä¸ªç”¨äºè·Ÿè¸ªè§¦æ‘¸çš„å±æ€§ã€‚
* touchesï¼šå½“å‰å±å¹•ä¸Šæ‰€æœ‰è§¦æ‘¸ç‚¹çš„åˆ—è¡¨
* targetTouchesï¼šå½“å‰å¯¹è±¡ä¸Šæ‰€æœ‰è§¦æ‘¸ç‚¹çš„åˆ—è¡¨
* changeTouchesï¼šæ¶‰åŠå½“å‰(å¼•å‘)äº‹ä»¶çš„è§¦æ‘¸ç‚¹çš„åˆ—è¡¨


1. ç”¨ä¸€ä¸ªæ‰‹æŒ‡æ¥è§¦å±å¹•ï¼Œè§¦å‘äº‹ä»¶ï¼Œæ­¤æ—¶è¿™ä¸‰ä¸ªå±æ€§æœ‰ç›¸åŒçš„å€¼ã€‚
2. ç”¨ç¬¬äºŒä¸ªæ‰‹æŒ‡æ¥è§¦å±å¹•ï¼Œæ­¤æ—¶ï¼Œtouchesæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªæ‰‹æŒ‡è§¦æ‘¸ç‚¹ä¸ºä¸€ä¸ªå€¼ã€‚å½“ä¸¤ä¸ªæ‰‹æŒ‡è§¦æ‘¸ç›¸åŒå…ƒç´ æ—¶ï¼Œ
targetToucheså’Œtouchesçš„å€¼ç›¸åŒï¼Œå¦åˆ™targetTouches åªæœ‰ä¸€ä¸ªå€¼ã€‚changedTouchesæ­¤æ—¶åªæœ‰ä¸€ä¸ªå€¼ï¼Œ
ä¸ºç¬¬äºŒä¸ªæ‰‹æŒ‡çš„è§¦æ‘¸ç‚¹ï¼Œå› ä¸ºç¬¬äºŒä¸ªæ‰‹æŒ‡æ˜¯**å¼•å‘äº‹ä»¶çš„åŸå› **
3. ç”¨ä¸¤ä¸ªæ‰‹æŒ‡åŒæ—¶æ¥è§¦å±å¹•ï¼Œæ­¤æ—¶changedTouchesæœ‰ä¸¤ä¸ªå€¼ï¼Œæ¯ä¸€ä¸ªæ‰‹æŒ‡çš„è§¦æ‘¸ç‚¹éƒ½æœ‰ä¸€ä¸ªå€¼
4. æ‰‹æŒ‡æ»‘åŠ¨æ—¶ï¼Œä¸‰ä¸ªå€¼éƒ½ä¼šå‘ç”Ÿå˜åŒ–
5.  ä¸€ä¸ªæ‰‹æŒ‡ç¦»å¼€å±å¹•ï¼Œtoucheså’ŒtargetTouchesä¸­å¯¹åº”çš„å…ƒç´ ä¼šåŒæ—¶ç§»é™¤ï¼Œè€ŒchangedTouchesä»ç„¶ä¼šå­˜åœ¨å…ƒç´ ã€‚
6. æ‰‹æŒ‡éƒ½ç¦»å¼€å±å¹•ä¹‹åï¼Œtoucheså’ŒtargetTouchesä¸­å°†ä¸ä¼šå†æœ‰å€¼ï¼Œ**changedTouchesè¿˜ä¼šæœ‰ä¸€ä¸ªå€¼ï¼Œ
æ­¤å€¼ä¸ºæœ€åä¸€ä¸ªç¦»å¼€å±å¹•çš„æ‰‹æŒ‡çš„æ¥è§¦ç‚¹ã€‚**(å¸¸å¸¸å¯ä»¥ç”¨äºtouchendäº‹ä»¶çš„é€»è¾‘å¤„ç†)




æ¯ä¸ªTouchå¯¹è±¡åŒ…å«çš„å±æ€§å¦‚ä¸‹ã€‚
* clientXï¼šè§¦æ‘¸ç›®æ ‡åœ¨è§†å£ä¸­çš„xåæ ‡ã€‚
* clientYï¼šè§¦æ‘¸ç›®æ ‡åœ¨è§†å£ä¸­çš„yåæ ‡ã€‚
* identifierï¼šæ ‡è¯†è§¦æ‘¸çš„å”¯ä¸€IDã€‚
* **pageXï¼šè§¦æ‘¸ç›®æ ‡åœ¨é¡µé¢ä¸­çš„xåæ ‡ã€‚**
* **pageYï¼šè§¦æ‘¸ç›®æ ‡åœ¨é¡µé¢ä¸­çš„yåæ ‡ã€‚**
* screenXï¼šè§¦æ‘¸ç›®æ ‡åœ¨å±å¹•ä¸­çš„xåæ ‡ã€‚
* screenYï¼šè§¦æ‘¸ç›®æ ‡åœ¨å±å¹•ä¸­çš„yåæ ‡ã€‚
* targetï¼šè§¦ç›®çš„DOMèŠ‚ç‚¹ç›®æ ‡ã€‚


### è§¦ç‚¹åæ ‡é€‰å–

touchstartå’Œtouchmoveä½¿ç”¨: e.targetTouches[0].pageX æˆ– (jquery)e.originalEvent.targetTouches[0].pageX

touchendä½¿ç”¨: e.changedTouches[0].pageX æˆ– (jquery)e.originalEvent.changedTouches[0].pageX




### åˆ¤æ–­æ‰‹æŒ‡æ»‘åŠ¨æ–¹å‘


```javascript
    var startx, starty;
        //è·å¾—è§’åº¦
        function getAngle(angx, angy) {
            return Math.atan2(angy, angx) * 180 / Math.PI;
        };
     
        //æ ¹æ®èµ·ç‚¹ç»ˆç‚¹è¿”å›æ–¹å‘ 1å‘ä¸Š 2å‘ä¸‹ 3å‘å·¦ 4å‘å³ 0æœªæ»‘åŠ¨
        function getDirection(startx, starty, endx, endy) {
            var angx = endx - startx;
            var angy = endy - starty;
            var result = 0;
     
            //å¦‚æœæ»‘åŠ¨è·ç¦»å¤ªçŸ­
            if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
                return result;
            }
     
            var angle = getAngle(angx, angy);
            if (angle >= -135 && angle <= -45) {
                result = 1;
            } else if (angle > 45 && angle < 135) {
                result = 2;
            } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
                result = 3;
            } else if (angle >= -45 && angle <= 45) {
                result = 4;
            }
     
            return result;
        }
        //æ‰‹æŒ‡æ¥è§¦å±å¹•
        document.addEventListener("touchstart", function(e) {
            startx = e.touches[0].pageX;
            starty = e.touches[0].pageY;
        }, false);
        //æ‰‹æŒ‡ç¦»å¼€å±å¹•
        document.addEventListener("touchend", function(e) {
            var endx, endy;
            endx = e.changedTouches[0].pageX;
            endy = e.changedTouches[0].pageY;
            var direction = getDirection(startx, starty, endx, endy);
            switch (direction) {
                case 0:
                    alert("æœªæ»‘åŠ¨ï¼");
                    break;
                case 1:
                    alert("å‘ä¸Šï¼")
                    break;
                case 2:
                    alert("å‘ä¸‹ï¼")
                    break;
                case 3:
                    alert("å‘å·¦ï¼")
                    break;
                case 4:
                    alert("å‘å³ï¼")
                    break;
                default:
            }
        }, false);
```



## audioç›¸å…³

[https://zhuanlan.zhihu.com/p/74566301](https://zhuanlan.zhihu.com/p/74566301)



### audioä¸è§¦å‘canplaythroughäº‹ä»¶

[https://www.cnblogs.com/pingfan1990/p/4595925.html](https://www.cnblogs.com/pingfan1990/p/4595925.html)



```js
var audio = new Audio();
audio.addEventListener("canplaythrough",function(){
    console.log("åŠ è½½å®Œæˆï¼");
},false);
audio.addEventListener("error",function(){
    console.log("åŠ è½½å¤±è´¥ï¼");
},false);
audio.src = src;
```



çœ‹è¿™æ®µä»£ç å¥½åƒæ²¡é”™ï¼Œåœ¨pcç«¯æ£€æµ‹ä¹Ÿæ²¡æœ‰é”™ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ”¾åˆ°h5ä¸Šé¢å°±ä¼šå‡ºé”™ï¼Œå› ä¸ºæ‰‹æœºä¸Šé¢éŸ³ä¹æ˜¯æµåª’ä½“åŠ è½½çš„ï¼Œå°±æ˜¯è¯´åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥æ’­æ”¾çš„ä¸€è¾¹åŠ è½½ä¸€è¾¹æ’­æ”¾ï¼Œ**canplaythrough äº‹ä»¶åœ¨ç§»åŠ¨ç«¯ï¼Œåªæœ‰å…è®¸audio/videoæ–‡ä»¶åŠ è½½æ’­æ”¾å®Œä¹‹åæ‰ä¼šæ‰§è¡Œã€‚**



```js
var audio = new Audio();
//canplaythroughè¿™ä¸ªäº‹ä»¶åœ¨æ‰‹æœºä¸Šæµåª’ä½“è¦ä¸€è¾¹æ’­æ”¾æ‰èƒ½ç›‘å¬å¾—åˆ°ï¼Œpcç«¯chromeå¯ä»¥å®Œç¾æ”¯æŒ
audio.addEventListener("canplaythrough",function(){
    //æˆ‘ä»¬å‘ç°æ’­æ”¾å®Œä¹‹åè¿™é‡Œæ‰§è¡Œäº†
    console.log("åŠ è½½å®Œæˆï¼");
},false);
audio.addEventListener("error",function(){
    console.log("åŠ è½½å¤±è´¥ï¼");
},false);
audio.src = src;
audio.play();
```



![](https://pic4.zhimg.com/v2-bae8255a8b714fc72631a22c61ce5973_r.jpg)









## å…ƒç´ æ‹–åŠ¨





[ç½‘é¡µé“¾æ¥](http://www.w3school.com.cn/html5/html_5_draganddrop.asp)

```html
<!DOCTYPE HTML>
<html>
<head>
<style type="text/css">
#div1 {width:198px; height:66px;padding:10px;border:1px solid #aaaaaa;}
</style>
<script type="text/javascript">
function allowDrop(ev)
{
ev.preventDefault();
}

function drag(ev)
{
ev.dataTransfer.setData("Text",ev.target.id);
}

function drop(ev)
{
ev.preventDefault();
var data=ev.dataTransfer.getData("Text");
ev.target.appendChild(document.getElementById(data));
}
</script>
</head>
<body>

<p>è¯·æŠŠ W3School çš„å›¾ç‰‡æ‹–æ”¾åˆ°çŸ©å½¢ä¸­ï¼š</p>

<div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
<br />
<img id="drag1" src="/i/eg_dragdrop_w3school.gif" draggable="true" ondragstart="drag(event)" />

</body>
</html>
```

### è®¾ç½®å…ƒç´ ä¸ºå¯æ‹–æ”¾

é¦–å…ˆï¼Œä¸ºäº†ä½¿å…ƒç´ å¯æ‹–åŠ¨ï¼ŒæŠŠ draggable å±æ€§è®¾ç½®ä¸º true ï¼š
`<img draggable="true" />`

### æ‹–åŠ¨ä»€ä¹ˆ - ondragstart å’Œ setData()

ç„¶åï¼Œè§„å®šå½“å…ƒç´ è¢«æ‹–åŠ¨æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œondragstart å±æ€§è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œdrag(event)ï¼Œå®ƒè§„å®šäº†è¢«æ‹–åŠ¨çš„æ•°æ®ã€‚
dataTransfer.setData() æ–¹æ³•è®¾ç½®è¢«æ‹–æ•°æ®çš„æ•°æ®ç±»å‹å’Œå€¼ï¼š

```
function drag(ev)
{
ev.dataTransfer.setData("Text",ev.target.id);
}
```

### æ”¾åˆ°ä½•å¤„ - ondragover

ondragover äº‹ä»¶è§„å®šåœ¨ä½•å¤„æ”¾ç½®è¢«æ‹–åŠ¨çš„æ•°æ®ã€‚
é»˜è®¤åœ°ï¼Œæ— æ³•å°†æ•°æ®/å…ƒç´ æ”¾ç½®åˆ°å…¶ä»–å…ƒç´ ä¸­ã€‚å¦‚æœéœ€è¦è®¾ç½®å…è®¸æ”¾ç½®ï¼Œæˆ‘ä»¬å¿…é¡»é˜»æ­¢å¯¹å…ƒç´ çš„é»˜è®¤å¤„ç†æ–¹å¼ã€‚
è¿™è¦é€šè¿‡è°ƒç”¨ ondragover äº‹ä»¶çš„ event.preventDefault() æ–¹æ³•ï¼š

```
event.preventDefault()
```

### è¿›è¡Œæ”¾ç½® - ondrop

å½“æ”¾ç½®è¢«æ‹–æ•°æ®æ—¶ï¼Œä¼šå‘ç”Ÿ drop äº‹ä»¶ã€‚
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œondrop å±æ€§è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œdrop(event)ï¼š

```
function drop(ev)
{
ev.preventDefault();
var data=ev.dataTransfer.getData("Text");
ev.target.appendChild(document.getElementById(data));
}
```


### ä»£ç è§£é‡Š

* è°ƒç”¨ preventDefault() æ¥é¿å…æµè§ˆå™¨å¯¹æ•°æ®çš„é»˜è®¤å¤„ç†ï¼ˆdrop äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯ä»¥é“¾æ¥å½¢å¼æ‰“å¼€ï¼‰
* é€šè¿‡ dataTransfer.getData("Text") æ–¹æ³•è·å¾—è¢«æ‹–çš„æ•°æ®ã€‚è¯¥æ–¹æ³•å°†è¿”å›åœ¨ setData() æ–¹æ³•ä¸­è®¾ç½®ä¸ºç›¸åŒç±»å‹çš„ä»»ä½•æ•°æ®ã€‚
* è¢«æ‹–æ•°æ®æ˜¯è¢«æ‹–å…ƒç´ çš„ id ("drag1")
* æŠŠè¢«æ‹–å…ƒç´ è¿½åŠ åˆ°æ”¾ç½®å…ƒç´ ï¼ˆç›®æ ‡å…ƒç´ ï¼‰ä¸­





## ç§»åŠ¨ç«¯100vhé—®é¢˜

åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ 100vh æ—¶ï¼Œå‘ç°åœ¨ Chromeã€Safari æµè§ˆå™¨ä¸­ï¼Œå› ä¸ºæµè§ˆå™¨æ å’Œä¸€äº›å¯¼èˆªæ ã€é“¾æ¥æ å¯¼è‡´ä¸ä¸€æ ·çš„å‘ˆç°ï¼š

* ä½ ä»¥ä¸ºçš„ 100vh === è§†å£é«˜åº¦
* å®é™…ä¸Š 100vh === è§†å£é«˜åº¦ + æµè§ˆå™¨å·¥å…·æ ï¼ˆåœ°å€æ ç­‰ç­‰ï¼‰çš„é«˜åº¦

**è§£å†³æ–¹æ¡ˆ**

å®‰è£… vh-check `npm install vh-check --save`

```js
import vhCheck from 'vh-check';
vhCheck('browser-address-bar');
```

å®šä¹‰ä¸€ä¸ª CSS Mixin

```scss
@mixin vh($height: 100vh) {
  height: $height;
  height: calc(#{$height} - var(--browser-address-bar, 0px));
}
```



## ç§»åŠ¨ç«¯1pxé—®é¢˜

å› ä¸ºRetineå±çš„åˆ†è¾¨ç‡å§‹ç»ˆæ˜¯æ™®é€šå±å¹•çš„2å€ï¼Œ1pxçš„è¾¹æ¡†åœ¨devicePixelRatio=2çš„retinaå±ä¸‹ä¼šæ˜¾ç¤ºæˆ2pxï¼Œæ‰€ä»¥åœ¨é«˜æ¸…å±ä¸‹çœ‹ç€1pxæ€»æ˜¯æ„Ÿè§‰å˜èƒ–äº†





## viewport

æ‰‹æœºæµè§ˆå™¨æ˜¯æŠŠé¡µé¢æ”¾åœ¨ä¸€ä¸ªè™šæ‹Ÿçš„â€œçª—å£â€ï¼ˆviewportï¼‰ä¸­ï¼Œé€šå¸¸è¿™ä¸ªè™šæ‹Ÿçš„â€œçª—å£â€ï¼ˆviewportï¼‰æ¯”å±å¹•å®½ï¼Œè¿™æ ·å°±ä¸ç”¨æŠŠæ¯ä¸ªç½‘é¡µæŒ¤åˆ°å¾ˆå°çš„çª—å£ä¸­ï¼ˆè¿™æ ·ä¼šç ´åæ²¡æœ‰é’ˆå¯¹æ‰‹æœºæµè§ˆå™¨ä¼˜åŒ–çš„ç½‘é¡µçš„å¸ƒå±€ï¼‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¹³ç§»å’Œç¼©æ”¾æ¥çœ‹ç½‘é¡µçš„ä¸åŒéƒ¨åˆ†ã€‚ç§»åŠ¨ç‰ˆçš„ Safari æµè§ˆå™¨æœ€æ–°å¼•è¿›äº† viewport è¿™ä¸ª meta tagï¼Œè®©ç½‘é¡µå¼€å‘è€…æ¥æ§åˆ¶ viewport çš„å¤§å°å’Œç¼©æ”¾ï¼Œå…¶ä»–æ‰‹æœºæµè§ˆå™¨ä¹ŸåŸºæœ¬æ”¯æŒã€‚



ä¸€ä¸ªå¸¸ç”¨çš„é’ˆå¯¹ç§»åŠ¨ç½‘é¡µä¼˜åŒ–è¿‡çš„é¡µé¢çš„ viewport meta æ ‡ç­¾å¤§è‡´å¦‚ä¸‹ï¼š

```html
<meta name=â€viewportâ€ content=â€width=device-width, initial-scale=1, maximum-scale=1â€³>
```

* widthï¼šæ§åˆ¶ viewport çš„å¤§å°ï¼Œå¯ä»¥æŒ‡å®šçš„ä¸€ä¸ªå€¼ï¼Œå¦‚æœ 600ï¼Œæˆ–è€…ç‰¹æ®Šçš„å€¼ï¼Œå¦‚ device-width ä¸ºè®¾å¤‡çš„å®½åº¦ï¼ˆå•ä½ä¸ºç¼©æ”¾ä¸º 100% æ—¶çš„ CSS çš„åƒç´ ï¼‰ã€‚
* heightï¼šå’Œ width ç›¸å¯¹åº”ï¼ŒæŒ‡å®šé«˜åº¦ã€‚
* initial-scaleï¼šåˆå§‹ç¼©æ”¾æ¯”ä¾‹ï¼Œä¹Ÿå³æ˜¯å½“é¡µé¢ç¬¬ä¸€æ¬¡ load çš„æ—¶å€™ç¼©æ”¾æ¯”ä¾‹ã€‚
* maximum-scaleï¼šå…è®¸ç”¨æˆ·ç¼©æ”¾åˆ°çš„æœ€å¤§æ¯”ä¾‹ã€‚
* minimum-scaleï¼šå…è®¸ç”¨æˆ·ç¼©æ”¾åˆ°çš„æœ€å°æ¯”ä¾‹ã€‚
* user-scalableï¼šç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰‹åŠ¨ç¼©æ”¾



viewportå¹¶éåªæ˜¯iosä¸Šçš„ç‹¬æœ‰å±æ€§ï¼Œåœ¨androidã€winphoneä¸ŠåŒæ ·ä¹Ÿæœ‰viewportã€‚å®ƒä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ç›¸åŒçš„ï¼Œå³æ— è§†è®¾å¤‡çš„çœŸå®åˆ†è¾¨ç‡ï¼Œç›´æ¥é€šè¿‡dpiï¼Œåœ¨ç‰©ç†å°ºå¯¸å’Œæµè§ˆå™¨ä¹‹é—´é‡è®¾åˆ†è¾¨ç‡ï¼Œè¿™ä¸ªåˆ†è¾¨ç‡å’Œè®¾å¤‡çš„åˆ†è¾¨ç‡æ— å…³ã€‚æ¯”å¦‚ï¼Œä½ æ‹¿ä¸ª3.5å¯¸-320 * 480çš„iphone3 gsã€3.5å¯¸-640 *960çš„iphone4æˆ–è€…9.7å¯¸-1024*768çš„ipad2ï¼Œè™½ç„¶è®¾å¤‡çš„åˆ†è¾¨ç‡ä¸åŒ,ç‰©ç†å°ºå¯¸ä¹Ÿä¸åŒï¼Œä½†ä½ å¯ä»¥é€šè¿‡è®¾ç½®viewportè®©å®ƒä»¬åœ¨æµè§ˆå™¨é‡Œæœ‰ç›¸åŒçš„åˆ†è¾¨ç‡ã€‚æ¯”å¦‚è¯´ï¼Œä½ çš„ç½‘ç«™æ˜¯800pxå®½ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®viewportçš„width=800ï¼Œæ¥è®©ä½ çš„ç½‘ç«™åœ¨è¿™ä¸‰ä¸ªä¸åŒçš„è®¾å¤‡ä¸Šéƒ½åˆšå¥½æ»¡å±æ˜¾ç¤ºä½ çš„ç½‘ç«™ã€‚





# iosé—®é¢˜





## ios æ»‘åŠ¨ä¸æµç•…



ä¸Šä¸‹æ»‘åŠ¨é¡µé¢ä¼šäº§ç”Ÿå¡é¡¿ï¼Œæ‰‹æŒ‡ç¦»å¼€é¡µé¢ï¼Œé¡µé¢ç«‹å³åœæ­¢è¿åŠ¨ã€‚æ•´ä½“è¡¨ç°å°±æ˜¯æ»‘åŠ¨ä¸æµç•…ï¼Œæ²¡æœ‰æ»‘åŠ¨æƒ¯æ€§ã€‚



**ä¸ºä»€ä¹ˆ iOS çš„ webview ä¸­ æ»‘åŠ¨ä¸æµç•…ï¼Œå®ƒæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿ**





 åŸæ¥åœ¨ iOS 5.0 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œæ»‘åŠ¨æœ‰å®šä¹‰æœ‰ä¸¤ä¸ªå€¼ `auto` å’Œ `touch`ï¼Œé»˜è®¤å€¼ä¸º `auto`ã€‚



```css
-webkit-overflow-scrolling: touch; /* å½“æ‰‹æŒ‡ä»è§¦æ‘¸å±ä¸Šç§»å¼€ï¼Œä¼šä¿æŒä¸€æ®µæ—¶é—´çš„æ»šåŠ¨ */

-webkit-overflow-scrolling: auto; /* å½“æ‰‹æŒ‡ä»è§¦æ‘¸å±ä¸Šç§»å¼€ï¼Œæ»šåŠ¨ä¼šç«‹å³åœæ­¢ */
```



### è§£å†³æ–¹æ¡ˆ



å°†`-webkit-overflow-scrolling` å€¼è®¾ç½®ä¸º `touch`

```css
.wrapper {   
	-webkit-overflow-scrolling: touch;
}
```



è®¾ç½®æ»šåŠ¨æ¡éšè—ï¼š

```css
.container ::-webkit-scrollbar {
    display: none;
}
```



----



è®¾ç½® overflow



è®¾ç½®å¤–éƒ¨ `overflow` ä¸º `hidden`,è®¾ç½®å†…å®¹å…ƒç´  `overflow` ä¸º `auto`ã€‚å†…éƒ¨å…ƒç´ è¶…å‡º body å³äº§ç”Ÿæ»šåŠ¨ï¼Œè¶…å‡ºçš„éƒ¨åˆ† body éšè—ã€‚



```css
body {
    overflow-y: hidden;
}
.wrapper {
    overflow-y: auto;
}
```





**ä¸¤è€…ç»“åˆä½¿ç”¨æ›´ä½³ï¼**







## ios ä¸Šæ‹‰è¾¹ç•Œä¸‹æ‹‰å‡ºç°ç™½è‰²ç©ºç™½



æ‰‹æŒ‡æŒ‰ä½å±å¹•ä¸‹æ‹‰ï¼Œå±å¹•é¡¶éƒ¨ä¼šå¤šå‡ºä¸€å—ç™½è‰²åŒºåŸŸã€‚æ‰‹æŒ‡æŒ‰ä½å±å¹•ä¸Šæ‹‰ï¼Œåº•éƒ¨å¤šå‡ºä¸€å—ç™½è‰²åŒºåŸŸã€‚



äº§ç”ŸåŸå› 



åœ¨ iOS ä¸­ï¼Œæ‰‹æŒ‡æŒ‰ä½å±å¹•ä¸Šä¸‹æ‹–åŠ¨ï¼Œä¼šè§¦å‘ `touchmove` äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶è§¦å‘çš„å¯¹è±¡æ˜¯æ•´ä¸ª `webview` å®¹å™¨ï¼Œå®¹å™¨è‡ªç„¶ä¼šè¢«æ‹–åŠ¨ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ä¼šæˆç©ºç™½ã€‚



### è§£å†³æ–¹æ¡ˆ



**ç›‘å¬äº‹ä»¶ç¦æ­¢æ»‘åŠ¨**





1. touchstart ï¼šæ‰‹æŒ‡æ”¾åœ¨ä¸€ä¸ªDOMå…ƒç´ ä¸Šã€‚
2. touchmove ï¼šæ‰‹æŒ‡æ‹–æ›³ä¸€ä¸ªDOMå…ƒç´ ã€‚
3. touchend ï¼šæ‰‹æŒ‡ä»ä¸€ä¸ªDOMå…ƒç´ ä¸Šç§»å¼€ã€‚





**`touchmove` äº‹ä»¶çš„é€Ÿåº¦æ˜¯å¯ä»¥å®ç°å®šä¹‰çš„ï¼Œå–å†³äºç¡¬ä»¶æ€§èƒ½å’Œå…¶ä»–å®ç°ç»†èŠ‚**

**`preventDefault` æ–¹æ³•ï¼Œé˜»æ­¢åŒä¸€è§¦ç‚¹ä¸Šæ‰€æœ‰é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚æ»šåŠ¨ã€‚**





ç”±æ­¤æˆ‘ä»¬æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ç›‘å¬ `touchmove`ï¼Œè®©éœ€è¦æ»‘åŠ¨çš„åœ°æ–¹æ»‘åŠ¨ï¼Œä¸éœ€è¦æ»‘åŠ¨çš„åœ°æ–¹ç¦æ­¢æ»‘åŠ¨ã€‚



> å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¦è¿‡æ»¤æ‰å…·æœ‰æ»šåŠ¨å®¹å™¨çš„å…ƒç´ ã€‚



å®ç°å¦‚ä¸‹ï¼š

```js
document.body.addEventListener('touchmove', function(e) {  
if(e._isScroller) return;   
    // é˜»æ­¢é»˜è®¤äº‹ä»¶   
    e.preventDefault();
}, { passive: false
});
```





-----



**æ»šåŠ¨å¦¥åå¡«å……ç©ºç™½ï¼Œè£…é¥°æˆå…¶ä»–åŠŸèƒ½**





åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¢ä¸€ç›´æ€è·¯ã€‚æ ¹æ®åœºæ™¯ï¼Œ**æˆ‘ä»¬å¯ä»¥å°†ä¸‹æ‹‰ä½œä¸ºä¸€ä¸ªåŠŸèƒ½æ€§çš„æ“ä½œ**ã€‚



**æ¯”å¦‚ï¼šä¸‹æ‹‰ååˆ·æ–°é¡µé¢**







## é¡µé¢æ”¾å¤§æˆ–ç¼©å°ä¸ç¡®å®šæ€§è¡Œä¸º


 HTML æœ¬èº«ä¼šäº§ç”Ÿæ”¾å¤§æˆ–ç¼©å°çš„è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨ PC æµè§ˆå™¨ä¸Šï¼Œå¯ä»¥è‡ªç”±æ§åˆ¶é¡µé¢çš„æ”¾å¤§ç¼©å°ã€‚ä½†æ˜¯åœ¨ç§»åŠ¨ç«¯ï¼Œæˆ‘ä»¬æ˜¯ä¸éœ€è¦è¿™ä¸ªè¡Œä¸ºçš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ç¦æ­¢è¯¥ä¸ç¡®å®šæ€§è¡Œä¸ºï¼Œæ¥æå‡ç”¨æˆ·ä½“éªŒã€‚



```html
<meta name=viewport content="width=device-width, initial-scale=1.0, minimum-scale=1.0 maximum-scale=1.0, user-scalable=no">
```







## click ç‚¹å‡»äº‹ä»¶å»¶æ—¶ä¸ç©¿é€



ç›‘å¬å…ƒç´  `click` äº‹ä»¶ï¼Œç‚¹å‡»å…ƒç´ è§¦å‘æ—¶é—´å»¶è¿Ÿçº¦ `300ms`ã€‚

ç‚¹å‡»è’™å±‚ï¼Œè’™å±‚æ¶ˆå¤±åï¼Œä¸‹å±‚å…ƒç´ ç‚¹å‡»è§¦å‘ã€‚



**ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿ click å»¶æ—¶ï¼Ÿ**

iOS ä¸­çš„ safariï¼Œä¸ºäº†å®ç°åŒå‡»ç¼©æ”¾æ“ä½œï¼Œåœ¨å•å‡» 300ms ä¹‹åï¼Œå¦‚æœæœªè¿›è¡Œç¬¬äºŒæ¬¡ç‚¹å‡»ï¼Œåˆ™æ‰§è¡Œ `click` å•å‡»æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´æ¥åˆ¤æ–­ç”¨æˆ·è¡Œä¸ºæ˜¯å¦ä¸ºåŒå‡»äº§ç”Ÿçš„ã€‚ä½†æ˜¯ï¼Œåœ¨ App ä¸­ï¼Œæ— è®ºæ˜¯å¦éœ€è¦åŒå‡»ç¼©æ”¾è¿™ç§è¡Œä¸ºï¼Œ`click` å•å‡»éƒ½ä¼šäº§ç”Ÿ 300ms å»¶è¿Ÿã€‚



**ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿ click ç‚¹å‡»ç©¿é€ï¼Ÿ**

åŒå±‚å…ƒç´ å åŠ æ—¶ï¼Œåœ¨ä¸Šå±‚å…ƒç´ ä¸Šç»‘å®š `touch` äº‹ä»¶ï¼Œä¸‹å±‚å…ƒç´ ç»‘å®š `click` äº‹ä»¶ã€‚ç”±äº `click` å‘ç”Ÿåœ¨ `touch` ä¹‹åï¼Œç‚¹å‡»ä¸Šå±‚å…ƒç´ ï¼Œå…ƒç´ æ¶ˆå¤±ï¼Œä¸‹å±‚å…ƒç´ ä¼šè§¦å‘ `click` äº‹ä»¶ï¼Œç”±æ­¤äº§ç”Ÿäº†ç‚¹å‡»ç©¿é€çš„æ•ˆæœã€‚



-----



### è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ touchstart æ›¿æ¢ click



å‰é¢å·²ç»ä»‹ç»äº†ï¼Œç§»åŠ¨è®¾å¤‡ä¸ä»…æ”¯æŒç‚¹å‡»ï¼Œè¿˜æ”¯æŒå‡ ä¸ªè§¦æ‘¸äº‹ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åŸºæœ¬æ€è·¯å°±æ˜¯ç”¨ `touch` äº‹ä»¶ä»£æ›¿`click` äº‹ä»¶ã€‚



å°† `click` æ›¿æ¢æˆ `touchstart` ä¸ä»…è§£å†³äº† `click` äº‹ä»¶éƒ½å»¶æ—¶é—®é¢˜ï¼Œè¿˜è§£å†³äº†ç©¿é€é—®é¢˜ã€‚å› ä¸ºç©¿é€é—®é¢˜æ˜¯åœ¨ `touch` å’Œ `click` æ··ç”¨æ—¶äº§ç”Ÿã€‚





å¼€æºè§£å†³æ–¹æ¡ˆä¸­ï¼Œä¹Ÿæ˜¯æ—¢æä¾›äº† `click` äº‹ä»¶ï¼Œåˆæä¾›äº†`touchstart` äº‹ä»¶ã€‚å¦‚ vant ä¸­çš„ `button` ç»„ä»¶




**é‚£ä¹ˆï¼Œæ˜¯å¦å¯ä»¥å°† `click` äº‹ä»¶å…¨éƒ¨æ›¿æ¢æˆ `touchstart` å‘¢ï¼Ÿä¸ºä»€ä¹ˆå¼€æºæ¡†æ¶è¿˜ä¼šç»™å‡º `click` äº‹ä»¶å‘¢ï¼Ÿ**





æˆ‘ä»¬æƒ³è±¡ä¸€ç§æƒ…æ™¯ï¼ŒåŒæ—¶éœ€è¦ç‚¹å‡»å’Œæ»‘åŠ¨çš„åœºæ™¯ä¸‹ã€‚å¦‚æœå°† `click` æ›¿æ¢æˆ `touchstart` ä¼šæ€æ ·ï¼Ÿ



> äº‹ä»¶è§¦å‘é¡ºåº: `touchstart`, `touchmove`, `touchend`, `click`ã€‚



å¾ˆå®¹æ˜“æƒ³è±¡ï¼Œåœ¨æˆ‘éœ€è¦`touchmove`æ»‘åŠ¨æ—¶å€™ï¼Œä¼˜å…ˆè§¦å‘äº†`touchstart`çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¯ä¸æ˜¯å·²ç»äº§ç”Ÿäº†å†²çªå‘¢ï¼Ÿ



æ‰€ä»¥å‘¢ï¼Œåœ¨å…·æœ‰æ»šåŠ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨ `click` å¤„ç†ã€‚



### è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ fastclick åº“

ä½¿ç”¨ `npm/yarn` å®‰è£…åä½¿ç”¨

```
import FastClick from 'fastclick';FastClick.attach(document.body, options);
```

åŒæ ·ï¼Œä½¿ç”¨`fastclick`åº“åï¼Œ`click` å»¶æ—¶å’Œç©¿é€é—®é¢˜éƒ½æ²¡äº†





## iPhone Xç³»åˆ—å®‰å…¨åŒºåŸŸé€‚é…é—®é¢˜

å¤´éƒ¨åˆ˜æµ·ä¸¤ä¾§åŒºåŸŸæˆ–è€…åº•éƒ¨åŒºåŸŸï¼Œå‡ºç°åˆ˜æµ·é®æŒ¡æ–‡å­—ï¼Œæˆ–è€…å‘ˆç°é»‘åº•æˆ–ç™½åº•ç©ºç™½åŒºåŸŸã€‚



äº§ç”ŸåŸå› 

iPhone X ä»¥åŠå®ƒä»¥ä¸Šçš„ç³»åˆ—ï¼Œéƒ½é‡‡ç”¨**åˆ˜æµ·å±è®¾è®¡**å’Œ**å…¨é¢å±æ‰‹åŠ¿**ã€‚å¤´éƒ¨ã€åº•éƒ¨ã€ä¾§è¾¹éƒ½éœ€è¦åšç‰¹æ®Šå¤„ç†ã€‚æ‰èƒ½é€‚é… iPhone X çš„ç‰¹æ®Šæƒ…å†µã€‚



### è§£å†³æ–¹æ¡ˆ

**è®¾ç½®å®‰å…¨åŒºåŸŸï¼Œå¡«å……å±é™©åŒºåŸŸï¼Œå±é™©åŒºåŸŸä¸åšæ“ä½œå’Œå†…å®¹å±•ç¤ºã€‚**

> å±é™©åŒºåŸŸæŒ‡å¤´éƒ¨ä¸è§„åˆ™åŒºåŸŸï¼Œåº•éƒ¨æ¨ªæ¡åŒºåŸŸï¼Œå·¦å³è§¦å‘åŒºåŸŸã€‚ 



å…·ä½“æ“ä½œä¸ºï¼š`viewport-fit` `meta` æ ‡ç­¾è®¾ç½®ä¸º `cover`ï¼Œè·å–æ‰€æœ‰åŒºåŸŸå¡«å……ã€‚åˆ¤æ–­è®¾å¤‡æ˜¯å¦å±äº iPhone Xï¼Œç»™å¤´éƒ¨åº•éƒ¨å¢åŠ **é€‚é…å±‚**



`viewport-fit` æœ‰ 3 ä¸ªå€¼åˆ†åˆ«ä¸ºï¼š

- `auto`ï¼šæ­¤å€¼ä¸å½±å“åˆå§‹å¸ƒå±€è§†å›¾ç«¯å£ï¼Œå¹¶ä¸”æ•´ä¸ªwebé¡µé¢éƒ½æ˜¯å¯æŸ¥çœ‹çš„ã€‚
- `contain`ï¼šè§†å›¾ç«¯å£æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œä»¥é€‚åˆæ˜¾ç¤ºå†…åµŒçš„æœ€å¤§çŸ©å½¢ã€‚
- `cover`ï¼šè§†å›¾ç«¯å£è¢«ç¼©æ”¾ä»¥å¡«å……è®¾å¤‡æ˜¾ç¤ºã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨ `safe area inset` å˜é‡ï¼Œä»¥ç¡®ä¿é‡è¦å†…å®¹ä¸ä¼šå‡ºç°åœ¨æ˜¾ç¤ºä¹‹å¤–ã€‚



è®¾ç½® viewport-fit ä¸º `cover`

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
```



å¢åŠ é€‚é…å±‚



ä½¿ç”¨ `safe area inset` å˜é‡





```
/* é€‚é… iPhone X é¡¶éƒ¨å¡«å……*/@supports (top: env(safe-area-inset-top)){  body,  .header{      padding-top: constant(safe-area-inset-top, 40px);      padding-top: env(safe-area-inset-top, 40px);      padding-top: var(safe-area-inset-top, 40px);  }}/* åˆ¤æ–­iPhoneX å°† footer çš„ padding-bottom å¡«å……åˆ°æœ€åº•éƒ¨ */@supports (bottom: env(safe-area-inset-bottom)){    body,    .footer{        padding-bottom: constant(safe-area-inset-bottom, 20px);        padding-bottom: env(safe-area-inset-bottom, 20px);        padding-top: var(safe-area-inset-bottom, 20px);    }
```





## è½¯é”®ç›˜å°†é¡µé¢é¡¶èµ·æ¥ã€æ”¶èµ·æœªå›è½é—®é¢˜

Android æ‰‹æœºä¸­ï¼Œç‚¹å‡» `input` æ¡†æ—¶ï¼Œé”®ç›˜å¼¹å‡ºï¼Œå°†é¡µé¢é¡¶èµ·æ¥ï¼Œå¯¼è‡´é¡µé¢æ ·å¼é”™ä¹±ã€‚

ç§»å¼€ç„¦ç‚¹æ—¶ï¼Œé”®ç›˜æ”¶èµ·ï¼Œé”®ç›˜åŒºåŸŸç©ºç™½ï¼Œæœªå›è½ã€‚

**äº§ç”ŸåŸå› **

æˆ‘ä»¬åœ¨app å¸ƒå±€ä¸­ä¼šæœ‰ä¸ªå›ºå®šçš„åº•éƒ¨ã€‚å®‰å“ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¾“å…¥å¼¹çª—å‡ºæ¥ï¼Œä¼šå°†è§£å‹ `absolute` å’Œ `fixed` å®šä½çš„å…ƒç´ ã€‚å¯¼è‡´å¯è§†åŒºåŸŸå˜å°ï¼Œå¸ƒå±€é”™ä¹±ã€‚



**åŸç†ä¸è§£å†³æ–¹æ¡ˆ**

è½¯é”®ç›˜å°†é¡µé¢é¡¶èµ·æ¥çš„è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯é€šè¿‡ç›‘å¬é¡µé¢é«˜åº¦å˜åŒ–ï¼Œå¼ºåˆ¶æ¢å¤æˆå¼¹å‡ºå‰çš„é«˜åº¦ã€‚



```js
// è®°å½•åŸæœ‰çš„è§†å£é«˜åº¦
const originalHeight = document.body.clientHeight || document.documentElement.clientHeight;

window.onresize = function(){
  var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
  if(resizeHeight < originalHeight ){
    // æ¢å¤å†…å®¹åŒºåŸŸé«˜åº¦
    // const container = document.getElementById("container")
    // ä¾‹å¦‚ container.style.height = originalHeight;
  }
}
```



é”®ç›˜ä¸èƒ½å›è½é—®é¢˜å‡ºç°åœ¨ iOS 12+ å’Œ wechat 6.7.4+ ä¸­ï¼Œè€Œåœ¨å¾®ä¿¡ H5 å¼€å‘ä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„ Bugã€‚









## ioså¼¹å‡ºé”®ç›˜å†æ”¶èµ·ç‚¹å‡»äº‹ä»¶æ— æ•ˆ



[ https://juejin.im/post/5c07442f51882528c4469769 ]( https://juejin.im/post/5c07442f51882528c4469769 )



æˆ‘ä»¬éƒ½çŸ¥é“åœ¨H5ç«¯æ˜¯æ²¡æ³•ç›‘æ§é”®ç›˜çš„å¼¹å‡ºä¸æ”¶èµ·çš„ï¼Œresizeäº‹ä»¶è§¦å‘çš„æœºå‹æå…¶æœ‰é™ï¼Œä½•å†µæˆ‘åœ¨iosä¸­å®æµ‹æ²¡æœ‰è§¦å‘ï¼Œå®‰å“åè€Œå¯ä»¥ã€‚å› ä¸ºå®‰å“å¼¹èµ·é”®ç›˜æ—¶ä¼šä¿®æ”¹è§†çª—çš„å¤§å°ï¼Œä½†æ˜¯ioså¹¶ä¸ä¼šï¼Œå¦‚æœä½ åœ¨iosä¸Šè®¾ç½®ä¸€ä¸ª100%é«˜åº¦çš„bodyï¼Œå¼¹èµ·é”®ç›˜åä½ ä¼šå‘ç°è¿™ä¸ªbodyæ˜¯å¯ä»¥ä¸Šä¸‹æ»šåŠ¨çš„ï¼Œå³100%é«˜åº¦çš„bodyè¶…å‡ºäº†è§†çª—ã€‚





 iosä¸Šä¸€ç›´æœ‰ä¸ªå¾ˆğŸ‚çš„ä¼˜åŒ–ï¼Œå¼¹å‡ºé”®ç›˜æ—¶ä¼šè‡ªåŠ¨æŠŠå½“å‰è¾“å…¥æ¡†æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸï¼Œåœ¨å®‰å“ä¸­ä¼šå‡ºç°é”®ç›˜é®æŒ¡è¾“å…¥æ¡†çš„é—®é¢˜ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒæ•´ 



----





ioså¼¹å‡ºé”®ç›˜å†æ”¶èµ·ç‚¹å‡»äº‹ä»¶æ— æ•ˆ,Whyï¼Ÿ



æ¨æµ‹æ˜¯bodyæ²¡æœ‰æ­£ç¡®é‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´ç‚¹å‡»äº‹ä»¶ä¸å¤„äºbodyå†…è€Œæ— æ³•è§¦å‘ã€‚



é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Œæ˜¯ä¸æ˜¯åªè¦æŠŠbodyâ€˜æ¨â€™ä¼šæ¥å°±è¡Œäº†ï¼Ÿ æ–¹å‘æœ‰äº†ï¼Œç°åœ¨æ˜¯å¦‚ä½•â€˜æ¨â€™çš„é—®é¢˜ã€‚

ä¸Šæ–‡æœ‰è¯´è¿‡ï¼Œiosä¸‹å¼¹å‡º/æ”¶èµ·é”®ç›˜æ˜¯æ²¡æœ‰è§¦å‘resizeäº‹ä»¶çš„ï¼Œé‚£ä¹ˆåœ¨ä»€ä¹ˆèŠ‚ç‚¹è§¦å‘â€˜æ¨â€™çš„æ“ä½œå°±æˆäº†é—®é¢˜ã€‚





----



 æœ€ç»ˆè§£å†³æ–¹æ¡ˆ 



```js
    onBlur = (e) => {
        const { onBlur } = this.props;
        document.body && (document.body.scrollTop = document.body.scrollTop);
        onBlur && onBlur(e);
    }
```





 åœ¨inputè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹çš„é’©å­ä¸­è®¾ç½®æ»šåŠ¨åˆ°åŸæœ‰ä½ç½®`(document.body.scrollTop = document.body.scrollTop)`ï¼Œè§¦å‘æµè§ˆå™¨çš„é‡ç»˜ï¼Œä½¿çš„é”™è¯¯çš„æ¸²æŸ“å›å¤æ­£å¸¸ï¼Œæ»šåŠ¨ä½ç½®ä¹Ÿä¸ä¼šæœ‰æ”¹å˜ï¼Œæ²¡æœ‰å½±å“ä½“éªŒã€‚ 





æ›´ä¸ºé€šç”¨çš„æ–¹æ³•



```js
/**
 * å¤„ç†iOS å¾®ä¿¡å®¢æˆ·ç«¯6.7.4 é”®ç›˜æ”¶èµ·é¡µé¢æœªä¸‹ç§»bug
 */
;(/iphone|ipod|ipad/i.test(navigator.appVersion)) && document.addEventListener('blur', (e) => {
    // è¿™é‡ŒåŠ äº†ä¸ªç±»å‹åˆ¤æ–­ï¼Œå› ä¸ºaç­‰å…ƒç´ ä¹Ÿä¼šè§¦å‘bluräº‹ä»¶
    ['input', 'textarea'].includes(e.target.localName) && document.body.scrollIntoView(false)
}, true)

```





 è¦åœ¨åŒ…ä¸ªå®šæ—¶å™¨æ‰èƒ½å½»åº•è§£å†³ï¼Œç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­è¾“å…¥æ³•çš„æƒ…å†µè¿˜æ˜¯ä¼šé”™ä½

```js
setTimeout(function(){         
    document.body.scrollIntoView(false);    
},200); 
```







## iosçš„fixedå®šä½é—®é¢˜

é€šå¸¸æˆ‘ä»¬ç†è§£çš„fixedå…ƒç´ çš„ç›¸å¯¹äºè§†çª—æ¥å®šä½çš„ï¼Œä½†æ˜¯åœ¨iosé‡Œï¼Œfixedå…ƒç´ æ˜¯ç›¸å¯¹äºæœ€å…ˆçš„ï¼Œtranfromå±æ€§ä¸ä¸ºnoneï¼ˆæˆ–è€…will-changeä¸ä¸ºnoneï¼‰çš„ç¥–å®—å…ƒç´ æ¥å®šä½çš„ã€‚





## è‹¹æœå¼‚å½¢å±é€‚é…æ–¹æ¡ˆ



```css
@supports ((height: constant(safe-area-inset-top)) or (height: env(safe-area-inse body {
/* */
padding-top: constant(safe-area-inset-top);
/* */
padding-bottom: constant(safe-area-inset-bottom); }
}
```







# å¾®ä¿¡h5é—®é¢˜



## htmlè¢«å¾®ä¿¡å¼ºåˆ¶ç¼“å­˜

htmlè¢«å¾®ä¿¡å¼ºåˆ¶ç¼“å­˜åœ¨æœ¬åœ°

> æ®æˆ‘ä»¬å¤šæ¬¡è¯•éªŒå’Œè§‚å¯Ÿï¼Œå¾®ä¿¡å¯¹æ•´ä¸ªH5é¡µé¢ç¼“å­˜äº†ï¼Œè€Œä¸æ˜¯å…¶ä¸­çš„å›¾ç‰‡ï¼Œcssç­‰èµ„æºï¼Œæ‰€ä»¥å¯¹å›¾ç‰‡ï¼ŒcssåŠ ä¸Šç‰ˆæœ¬æ§åˆ¶å¯èƒ½å¯¹è¯¥é—®é¢˜æ— æ•ˆã€‚

è§£å†³æ–¹æ¡ˆ

* é€šè¿‡urlåŠ æ—¶é—´æˆ³æˆ–å…¶ä»–å‚æ•°é¿å…ç¼“å­˜
* getè¯·æ±‚åŠ ä¸Šæ—¶é—´æˆ³å‚æ•°
* é€šè¿‡æœåŠ¡ç«¯(nginx)è§£å†³   (**ç›´æ¥å°†nginxçš„ç¼“å­˜è®¾ç½®æˆ{expires-1;}ï¼Œè®¾ç½®æˆæ°¸è¿œä¸ç¼“å­˜**)







# è¡¥å……



## Flutter å’Œ RN

[https://ask.dcloud.net.cn/article/36083](https://ask.dcloud.net.cn/article/36083)

React Nativeä½¿ç”¨çš„JavaScriptè¯­è¨€å¼€å‘, Flutteä½¿ç”¨çš„æ˜¯Dartè¯­è¨€



![v2-375798a9424bf72b0e60156702ec5ed5_1440w](https://pic2.zhimg.com/80/v2-375798a9424bf72b0e60156702ec5ed5_1440w.jpg)



* Flutterå®Œå…¨ç‹¬ç«‹äºå¹³å°å±‚çš„æ¸²æŸ“ç®¡çº¿çš„ä¼˜åŠ¿
* RNæ˜ å°„å®ä½“ç»„ä»¶çš„æ–¹å¼
* **React Native å¸¦æœ‰è¾ƒå¼ºçš„å¹³å°å…³è”æ€§ï¼Œè€Œ Flutter UI çš„å¹³å°å…³è”æ€§ååˆ†è–„å¼±ã€‚**



**React Native** æ˜¯ä¸€å¥— UI æ¡†æ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ **React Native** ä¼šåœ¨ `Activity` ä¸‹åŠ è½½ JS æ–‡ä»¶ï¼Œç„¶åè¿è¡Œåœ¨ `JavaScriptCore` ä¸­è§£æ *Bundle* æ–‡ä»¶å¸ƒå±€ï¼Œæœ€ç»ˆå †å å‡ºä¸€ç³»åˆ—çš„åŸç”Ÿæ§ä»¶è¿›è¡Œæ¸²æŸ“ã€‚

ç®€å•æ¥è¯´å°±æ˜¯ **é€šè¿‡å†™ JS ä»£ç é…ç½®é¡µé¢å¸ƒå±€ï¼Œç„¶å React Native æœ€ç»ˆä¼šè§£ææ¸²æŸ“æˆåŸç”Ÿæ§ä»¶**ï¼Œå¦‚ `<View>` æ ‡ç­¾å¯¹åº” `ViewGroup/UIView` ï¼Œ`<ScrollView>` æ ‡ç­¾å¯¹åº” `ScrollView/UIScrollView` ï¼Œ`<Image>` æ ‡ç­¾å¯¹åº” `ImageView/UIImageView` ç­‰ã€‚

---

*å¦‚æœè¯´ **React Native** æ˜¯ä¸ºå¼€å‘è€…åšäº†å¹³å°å…¼å®¹ï¼Œé‚£ **Flutter** åˆ™æ›´åƒæ˜¯ä¸ºå¼€å‘è€…å±è”½å¹³å°çš„æ¦‚å¿µã€‚*

> **Flutter** ä¸­åªéœ€å¹³å°æä¾›ä¸€ä¸ª `Surface` å’Œä¸€ä¸ª `Canvas` ï¼Œå‰©ä¸‹çš„ **Flutter** è¯´ï¼š*â€œä½ å¯ä»¥èººä¸‹äº†ï¼Œæˆ‘ä»¬æ¥è‡ªå·±åŠ¨â€ã€‚*

**Flutter** ä¸­ç»å¤§éƒ¨åˆ†çš„ `Widget` éƒ½ä¸å¹³å°æ— å…³ï¼Œ å¼€å‘è€…åŸºäº `Framework` å¼€å‘ App ï¼Œè€Œ `Framework` è¿è¡Œåœ¨ `Engine` ä¹‹ä¸Šï¼Œç”± `Engine` è¿›è¡Œé€‚é…å’Œè·¨å¹³å°æ”¯æŒã€‚è¿™ä¸ªè·¨å¹³å°çš„æ”¯æŒè¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯å°† **Flutter UI ä¸­çš„ `Widget` â€œæ•°æ®åŒ–â€ ï¼Œç„¶åé€šè¿‡ `Engine` ä¸Šçš„ `Skia` ç›´æ¥ç»˜åˆ¶åˆ°å±å¹•ä¸Š ã€‚**

**Flutter åˆ™æ˜¯è®©ä½ å¿˜æ‰å¹³å°ï¼Œä¸“æ³¨äº Flutter UI å°±å¥½äº†ã€‚**

**Flutter çš„æ•´ä½“æ¸²æŸ“è„±ç¦»äº†åŸç”Ÿå±‚é¢ï¼Œç›´æ¥å’Œ GPU äº¤äº’**

 







### åŠ¨æ€æ€§

webviewã€rn/weexï¼Œéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥è¿œç¨‹åŠ¨æ€è½½å…¥jsä»£ç ï¼Œå¯ä»¥æ›´æ–°æœ¬åœ°çš„jsä»£ç ã€‚å‰ç«¯å¼€å‘è€…è®¤ä¸ºåŠ¨æ€æ€§æ˜¯å¤©ç»åœ°ä¹‰çš„ï¼Œä½†å…¶å®flutterå¹¶ä¸æ”¯æŒã€‚

flutteræ˜¯æœ‰ç¼–è¯‘ä¼˜åŒ–æ¦‚å¿µçš„ï¼Œå¦‚æœå®ƒæä¾›åŠ¨æ€æ€§æ”¯æŒï¼Œä¼šå½±å“å®ƒçš„æ€§èƒ½ã€‚

é™¤äº†flutterï¼Œrn/weex/uni-appéƒ½å¯ä»¥åŠ¨æ€çƒ­æ›´æ–°ã€‚





### Flutterçš„ä¼˜åŠ¿

- æ€§èƒ½ä¸Šä¼˜äºReact Native

  - RN æ‰€ä½¿ç”¨çš„JSCore,åŸæœ¬ç”¨åœ¨æµè§ˆå™¨ä¸­,ç”¨äºè§£é‡Šæ‰§è¡Œç½‘é¡µä¸­çš„JavaScriptdä»£ç ,ä¸ºäº†å…¼å®¹Webæ ‡å‡†ç•™ä¸‹çš„å†å²åŒ…è¢±, æ— æ³•é’ˆå¯¹ç§»åŠ¨ç«¯è¿›è¡Œæ€§èƒ½ä¼˜åŒ–
  - Flutter ä¸€å¼€å§‹å°±æŠ›å¼ƒäº†è¿™ç§åŒ…è¢±,ä½¿ç”¨å…¨æ–°çš„Dartè¯­è¨€è¿›è¡Œç¼–å†™,åŒæ—¶æ”¯æŒAOTå’ŒJITä¸¤ç§ç¼–è¯‘æ–¹å¼, è€Œæ²¡æœ‰é‡‡ç”¨HTML/CSS/JavaScriptzç»„åˆæ–¹å¼å¼€å‘, åœ¨æ‰§è¡Œæ•ˆç‡ä¸Šæ˜æ˜¾é«˜äºJSCore

- å¼€å‘æ•ˆç‡ä½“éªŒä¼˜è¶Š

  - å‡­å€Ÿçƒ­é‡è½½è¿™ç§æ€¥é€Ÿè°ƒè¯•æŠ€æœ¯,æå¤§çš„æå‡äº†å¼€å‘æ•ˆç‡
  - Flutterå› ä¸ºé‡æ–°å®ç°äº†UIæ¡†æ¶,å¯ä»¥ä¸ä¾èµ–IOSå’ŒAndroidå¹³å°çš„åŸç”Ÿæ§ä»¶,æ‰€ä»¥æ— éœ€ä¸“é—¨å»å¤„ç†å¹³å°ä¸Šçš„å·®å¼‚,åœ¨å¼€å‘ä½“éªŒä¸Šå®ç°äº†çœŸæ­£çš„ç»Ÿä¸€

  å› ä¸ºå¼•æ“å®šåˆ¶é—®é¢˜,flutteråŒ…çš„å¤§å°æ˜¯ä¸€ä¸ªé—®é¢˜,ä»é•¿è¿œæ¥çœ‹,App storeå¯¹åŒ…çš„å¤§å°çš„é™åˆ¶åªä¼šè¶Šæ¥è¶Šå°,æ‰€ä»¥è¯´è¿™ä¸ªé—®é¢˜ä¸€å®šä¸ä¼šæˆä¸ºå¡ç‚¹

  åŠ¨æ€åŒ–èƒ½åŠ›é»˜è®¤ä¸æ”¯æŒåœ¨iosä¸Šé¢çƒ­æ›´





## uni-app

å¯¹äºå›½å¤–çš„å¼€å‘è€…ï¼Œrnã€flutterçš„ç”Ÿæ€è‚¯å®šæ¯”uni-appå¥½ï¼Œæ¯”å¦‚facebookç™»é™†åˆ†äº«ã€Googleåœ°å›¾ç­‰ã€‚

ä½†å¯¹äºå›½å†…çš„å¼€å‘è€…ï¼Œé‚£æ˜¯åè¿‡æ¥çš„ï¼Œä¸­å›½å¼€å‘è€…éœ€è¦çš„å…¨ç«¯æ¨é€ï¼ˆUniPushé›†æˆäº†iOSã€åä¸ºã€å°ç±³ã€OPPOç­‰ä¼—å¤šåŸå‚æ¨é€ï¼‰ã€å„ç§å›½å†…ç™»é™†ã€æ”¯ä»˜ã€åˆ†äº«SDKã€å„ç§å›½å†…åœ°å›¾ã€å„ç§uiåº“ã€ä»¥åŠEchartå›¾è¡¨ç­‰ï¼Œéƒ½æ˜¯åœ¨uni-appä½“ç³»é‡Œï¼Œè¿™æ–¹é¢ç”Ÿæ€å¯æ¯”rnã€flutterä¸°å¯Œå¤šäº†ã€‚uni-appçš„æ’ä»¶å¸‚åœºæœ‰æ•°åƒæ¬¾æ’ä»¶ï¼Œä¸èƒ½è¯´åº”æœ‰å°½æœ‰ï¼Œä½†ç¡®å®æ˜¯æœ€ä¸°å¯Œçš„è·¨ç«¯å¼€å‘æ¡†æ¶ç”Ÿæ€äº†ã€‚



å¦å¤–ï¼Œuni-appçš„ç”Ÿæ€è¿˜æ¯”å…¶ä»–ç«å“å¼ºåœ¨å¦‚ä¸‹æ–¹é¢ï¼š

- Appå’ŒH5æä¾›äº†renderjsæŠ€æœ¯ï¼Œä½¿å¾—æµè§ˆå™¨ä¸“ç”¨çš„åº“ä¹Ÿå¯ä»¥åœ¨Appå’ŒH5é‡Œä½¿ç”¨ï¼Œæ¯”å¦‚echartã€threejsç­‰[å‚è€ƒ](https://uniapp.dcloud.io/frame?id=renderjs)
- å…¼å®¹å¾®ä¿¡å°ç¨‹åº JS SDKï¼Œä¸°å¯Œçš„å°ç¨‹åºç”Ÿæ€å†…å®¹å¯ç›´æ¥å¼•å…¥uni-appï¼Œå¹¶ä¸”åœ¨Appä¾§é€šç”¨ï¼Œ[å‚è€ƒ](http://ask.dcloud.net.cn/article/35070)
- å…¼å®¹å¾®ä¿¡å°ç¨‹åºè‡ªå®šä¹‰ç»„ä»¶ï¼Œå¹¶ä¸”Appã€H5ä¾§é€šç”¨ï¼Œ[å‚è€ƒ](http://uniapp.dcloud.io/frame?id=å°ç¨‹åºç»„ä»¶æ”¯æŒ)

è¿™äº›ä¸°å¯Œçš„ç”Ÿæ€å…¼å®¹ï¼Œæ˜¯rnå’Œflutteræ— æ³•äº«å—çš„ã€‚



## JITå’ŒAOT

JIT (Just-In-Time - å®æ—¶ç¼–è¯‘)     ä»£è¡¨ javaScriptã€python

AOT (Ahead-Of-Time - é¢„å…ˆç¼–è¯‘)    ä»£è¡¨ C/C++  java     **(æ³¨æ„javaçš„ç‰¹æ®Šæ€§)**

* JITï¼šååé‡é«˜ï¼Œæœ‰è¿è¡Œæ—¶æ€§èƒ½åŠ æˆï¼Œå¯ä»¥è·‘å¾—æ›´å¿«ï¼Œå¹¶å¯ä»¥åšåˆ°åŠ¨æ€ç”Ÿæˆä»£ç ç­‰ï¼Œä½†æ˜¯ç›¸å¯¹å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶éœ€è¦ä¸€å®šæ—¶é—´å’Œè°ƒç”¨é¢‘ç‡æ‰èƒ½è§¦å‘ JIT çš„åˆ†å±‚æœºåˆ¶
* AOTï¼šå†…å­˜å ç”¨ä½ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œå¯ä»¥æ— éœ€ runtime è¿è¡Œï¼Œç›´æ¥å°† runtime é™æ€é“¾æ¥è‡³æœ€ç»ˆçš„ç¨‹åºä¸­ï¼Œä½†æ˜¯æ— è¿è¡Œæ—¶æ€§èƒ½åŠ æˆï¼Œä¸èƒ½æ ¹æ®ç¨‹åºè¿è¡Œæƒ…å†µåšè¿›ä¸€æ­¥çš„ä¼˜åŒ–





## JSBridge

[H5å’Œappä¹‹é—´å¦‚ä½•é€šä¿¡](https://juejin.cn/post/6945007689990832141)

[æ·±å…¥æµ…å‡ºJSBridgeï¼šä»åŸç†åˆ°ä½¿ç”¨](https://juejin.cn/post/6936814903021797389#heading-4)

JSBridge å°±åƒå…¶åç§°ä¸­çš„ã€Bridgeã€çš„æ„ä¹‰ä¸€æ ·ï¼Œæ˜¯ Native å’Œé Native ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯ æ„å»º Native å’Œé Native é—´æ¶ˆæ¯é€šä¿¡çš„é€šé“ï¼Œè€Œä¸”æ˜¯ åŒå‘é€šä¿¡çš„é€šé“ã€‚



æ‰€è°“ åŒå‘é€šä¿¡çš„é€šé“:

- JS å‘ Native å‘é€æ¶ˆæ¯ : è°ƒç”¨ç›¸å…³åŠŸèƒ½ã€é€šçŸ¥ Native å½“å‰ JS çš„ç›¸å…³çŠ¶æ€ç­‰ã€‚
- Native å‘ JS å‘é€æ¶ˆæ¯ : å›æº¯è°ƒç”¨ç»“æœã€æ¶ˆæ¯æ¨é€ã€é€šçŸ¥ JS å½“å‰ Native çš„çŠ¶æ€ç­‰ã€‚



---

**Native->Web**



Android 4.4ä¹‹åæä¾›äº†**evaluateJavascript**æ¥æ‰§è¡ŒJSä»£ç ï¼Œå¹¶ä¸”å¯ä»¥è·å–è¿”å›å€¼æ‰§è¡Œå›è°ƒï¼š

```java
String jsCode = String.format("window.showWebDialog('%s')", text);
webView.evaluateJavascript(jsCode, new ValueCallback<String>() {
  @Override
  public void onReceiveValue(String value) {

  }
});
å¤åˆ¶ä»£ç 
```

iOSçš„UIWebViewä½¿ç”¨**stringByEvaluatingJavaScriptFromString**ï¼š

```objective-c
NSString *jsStr = @"æ‰§è¡Œçš„JSä»£ç ";
[webView stringByEvaluatingJavaScriptFromString:jsStr];
```



Web->Native

æ³¨å…¥ API å’Œ æ‹¦æˆª URL SCHEME



















[1]: https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-4.png
[2]: https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-5.png
[3]: https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-6.png

