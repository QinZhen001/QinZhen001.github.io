---
layout:     post
title:      "微信小程序爬坑"
date:       2018-05-26 23:25:00
author:     "Qz"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 微信小程序
---

> “Yeah It's on. ”



## 原生小程序相关

### Content-type问题

官网里面的示例代码中content-type是设置为'application/json'的，然而……！！！

但是原来是微信开发工具升级后，请求的header的Content-type写法变了，要改成:

**header: { content-type: 'json' }**

>tip: content-type 默认为 'application/json';


[网络请求之re.request 和那些坑](https://www.cnblogs.com/huangenai/p/6427911.html)



### header
header 为 application/json，接口传回来的参数要是json 格式的，否则会报500错误，接口返回来的参数是xml则header['content-type'] 要设置为'application/x-www-form-urlencoded'


### method 
**需大写**

有效值：OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT 	


### data 数据说明
* 对于 GET 方法的数据，会将数据转换成 query string（encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...）
* 对于 POST 方法且 header['content-type'] 为 application/json 的数据，会对数据进行 JSON 序列化
* 对于 POST 方法且 header['content-type'] 为 application/x-www-form-urlencoded 的数据，会将数据转换成 query string （encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...）


### scroll-view横向滚动

scroll-view横向无法滚动

要设置css样式 
```css
white-space: nowrap;
```



### 去除border边框
问题：
使用传统的用“border:none;来去除边框”，依旧有一条细细的border;

解决:
使用 button::after{ border: none; } 来去除边框





### canvas的drawImage
问题：真机canvas的drawImage无法加载加载网络图片

解决：canvas上绘制的目前只支持本地图片,网页上的图片如果是网络图片，在显示时都会暂存在本地，有的直接在缓存中。所以，我们使用getimageinfo去获取到我们的图片的信息先（主要是缓存在本地的时候，会保存下一个临时文件），接着再去使用这个方式去保存到本地的相册

```javascript
    //拿到可以在canvas绘制的图片url
    getImageInfo (url) {
      return new Promise((resolve, reject) => {
        /* 获得要在画布上绘制的图片 */
        const objExp = new RegExp(/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/)
        if (objExp.test(url)) {
          wx.getImageInfo({
            src: url,
            complete (res) {
              if (res.errMsg === 'getImageInfo:ok') {
                console.log('网络图片', res.path)
                resolve(res.path)
              } else {
                reject(new Error('getImageInfo fail'))
              }
            }
          })
        } else {
          console.log('本地图片', url)
          resolve(url)
        }
      })
    }
```



## mpvue相关

[http://mpvue.com/mpvue/](http://mpvue.com/mpvue/)

### 不支持函数
不支持在 template 内使用 methods 中的函数。

解决方法:写在computed里



### 滑动组件相关
[http://kuangpf.com/mpvue-weui/#/slider](http://kuangpf.com/mpvue-weui/#/slider)

bindchange和bindchanging 在mpvue框架中的写法为: @change和@changing

类型为事件的属性在完成触发事件后，取值的方式为：event.mp.detail = {value: value}


